"use strict";jQuery(document).ready(function(){var s,n,t,r,a,i,l,e,o,c,d,u,v,h,f,k,b,p,I,m,g,U,S=jQuery.noConflict(),A=(s=[],n=[],r={isValid:!(t=""),reason:""},{updateSelectedUserIdsFromCheckbox:function(e){var t=parseInt(e.val(),10),i=s.indexOf(t);return e.is(":checked")?i<0&&s.push(t):-1<i&&s.splice(i,1),this},getUserIds:function(){return s},setAction:function(e){return t=e,this},setCourseIds:function(e){var t,i,s;return t=e,i=function(e){return parseInt(e,10)},s=[],S.each(t,function(e,t){s.push(i(t))}),n=s,this},resetSelectedUserIds:function(){return s=[],this},resetAll:function(){return this.resetSelectedUserIds(),n=[],t="",this},validator:function(){return{validateBulkAction:function(){return""==t?{isValid:!1,reason:"Select an action"}:r},validateCourseIds:function(){return 0===(e=n,i=function(e){return!isNaN(e)},s=[],S.each(e,function(e,t){i(t)&&s.push(t)}),s).length?{isValid:!1,reason:"Select a course"}:r;var e,i,s},validateSelectedUserIds:function(){return 0===s.length?{isValid:!1,reason:"Select some learners"}:r},validate:function(){for(var e,t=[this.validateSelectedUserIds,this.validateBulkAction,this.validateCourseIds];0<t.length;)if(!(e=t.shift().call(this)).isValid)return e;return r}}},validate:function(){return this.validator().validate()}});a=A,i=S("#bulk-action-user-ids"),l=S("#bulk-action-course-ids"),e=S("#bulk-learner-action-submit"),o=S("#bulk-learner-actions-form"),c=S("#bulk-action-selector-top"),d=S("#sensei-bulk-action"),u=S(".sensei-course-select"),v=S("#bulk-action-course-select"),h=S(".sensei_user_select_id"),f=S("#cb-select-all-1"),k=S(".learner-course-overview-detail"),b=S(".learner-course-overview-detail-btn"),p=S("#cb-select-all-2"),I=S("#sensei-bulk-learner-actions-modal-toggle"),m=S("#sensei-bulk-learner-actions-modal"),g=function(e,t){e.on("click",function(){a.resetSelectedUserIds(),e.is(":checked")?(t.attr("checked","checked"),h.attr("checked","checked"),h.each(function(e,t){a.updateSelectedUserIdsFromCheckbox(S(t))})):(h.removeAttr("checked"),t.removeAttr("checked")),U()})},U=function(){var e=a.validator(),t=e.validateBulkAction(),i=e.validateSelectedUserIds();t.isValid&&i.isValid?I.removeAttr("disabled"):I.attr("disabled",!0)},u.select2({placeholder:window.sensei_learners_bulk_data.select_course_placeholder,width:"300px"}),h.on("change",function(e){var t=S(this);e.preventDefault(),e.stopPropagation(),a.updateSelectedUserIdsFromCheckbox(t),U()}),g(f,p),g(p,f),I.attr("disabled",!0),I.on("click",function(){return m.modal({fadeDuration:100,fadeDelay:.5}),!1}),b.on("click",function(e){e.preventDefault(),e.stopPropagation();var t=S(this).siblings(".learner-course-overview-detail").first();k.filter(":visible").slideUp("slow"),t.is(":hidden")?t.slideDown("slow"):t.slideUp("slow")}),c.on("change",function(){d.val(c.val().trim()),a.setAction(d.val()),U()}),v.on("change",function(){a.setCourseIds(v.val()).validator().validateCourseIds().isValid?e.removeAttr("disabled"):e.attr("disabled",!0)}),e.attr("disabled",!0),e.on("click",function(e){e.preventDefault(),e.stopPropagation(),a.setCourseIds(v.val()).setAction(d.val().trim()),a.validate().isValid&&(i.val(a.getUserIds().join(",")),l.val(v.val().join(",")),o.submit())})});