"use strict";jQuery(document).ready(function(){var e=jQuery.noConflict(),t=function(t,i){var n=[];return e.each(t,function(e,t){n.push(i(t))}),n},i=function(t,i){var n=[];return e.each(t,function(e,t){i(t)&&n.push(t)}),n},n=function(){var e=[],n=[],r="",s={isValid:!0,reason:""};return{updateSelectedUserIdsFromCheckbox:function(t){var i=parseInt(t.val(),10),n=e.indexOf(i);return t.is(":checked")?n<0&&e.push(i):n>-1&&e.splice(n,1),this},getUserIds:function(){return e},setAction:function(e){return r=e,this},setCourseIds:function(e){return n=t(e,function(e){return parseInt(e,10)}),this},resetSelectedUserIds:function(){return e=[],this},resetAll:function(){return this.resetSelectedUserIds(),n=[],r="",this},validator:function(){return{validateBulkAction:function(){return""==r?{isValid:!1,reason:"Select an action"}:s},validateCourseIds:function(){return 0===i(n,function(e){return!isNaN(e)}).length?{isValid:!1,reason:"Select a course"}:s},validateSelectedUserIds:function(){return 0===e.length?{isValid:!1,reason:"Select some learners"}:s},validate:function(){for(var e,t=[this.validateSelectedUserIds,this.validateBulkAction,this.validateCourseIds];t.length>0;)if(e=t.shift().call(this),!e.isValid)return e;return s}}},validate:function(){return this.validator().validate()}}}();!function(t){var i=e("#bulk-action-user-ids"),n=e("#bulk-action-course-ids"),r=e("#bulk-learner-action-submit"),s=e("#bulk-learner-actions-form"),a=e("#bulk-action-selector-top"),l=e("#sensei-bulk-action"),o=e(".sensei-course-select"),c=e("#bulk-action-course-select"),d=e(".sensei_user_select_id"),u=e("#cb-select-all-1"),v=e(".learner-course-overview-detail"),f=e(".learner-course-overview-detail-btn"),h=e("#cb-select-all-2"),k=e("#sensei-bulk-learner-actions-modal-toggle"),b=e("#sensei-bulk-learner-actions-modal"),p=function(i,n){i.on("click",function(){t.resetSelectedUserIds(),i.is(":checked")?(n.attr("checked","checked"),d.attr("checked","checked"),d.each(function(i,n){t.updateSelectedUserIdsFromCheckbox(e(n))})):(d.removeAttr("checked"),n.removeAttr("checked")),I()})},I=function(){var e=t.validator(),i=e.validateBulkAction(),n=e.validateSelectedUserIds();i.isValid&&n.isValid?k.removeAttr("disabled"):k.attr("disabled",!0)};o.select2({placeholder:window.sensei_learners_bulk_data.select_course_placeholder,width:"300px"}),d.on("change",function(i){var n=e(this);i.preventDefault(),i.stopPropagation(),t.updateSelectedUserIdsFromCheckbox(n),I()}),p(u,h),p(h,u),k.attr("disabled",!0),k.on("click",function(){return b.modal({fadeDuration:100,fadeDelay:.5}),!1}),f.on("click",function(t){t.preventDefault(),t.stopPropagation();var i=e(this),n=i.siblings(".learner-course-overview-detail").first();v.filter(":visible").slideUp("slow"),n.is(":hidden")?n.slideDown("slow"):n.slideUp("slow")}),a.on("change",function(){l.val(a.val().trim()),t.setAction(l.val()),I()}),c.on("change",function(){var e=t.setCourseIds(c.val()).validator().validateCourseIds().isValid;e?r.removeAttr("disabled"):r.attr("disabled",!0)}),r.attr("disabled",!0),r.on("click",function(e){e.preventDefault(),e.stopPropagation(),t.setCourseIds(c.val()).setAction(l.val().trim());var r=t.validate();r.isValid&&(i.val(t.getUserIds().join(",")),n.val(c.val().join(",")),s.submit())})}(n)});